<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>TruBuzz Challenge by Easter1021</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>TruBuzz Challenge</h1>
        <p>Create a  Laravel homestead docker container for your development env.</p>

        <p class="view"><a href="https://github.com/Easter1021/homestead-docker">View the Project on GitHub <small>Easter1021/homestead-docker</small></a></p>


        <ul>
          <li><a href="https://github.com/Easter1021/homestead-docker/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/Easter1021/homestead-docker/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/Easter1021/homestead-docker">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="trubuzz-challenge" class="anchor" href="#trubuzz-challenge" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TruBuzz Challenge</h1>

<h2>
<a id="install-docker--docker-compose" class="anchor" href="#install-docker--docker-compose" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install docker &amp;&amp; docker compose</h2>

<p>Docker環境基本安裝:</p>

<ul>
<li>install docker (<a href="https://docs.docker.com/installation/ubuntulinux/">https://docs.docker.com/installation/ubuntulinux/</a>)</li>
</ul>

<div class="highlight highlight-source-shell"><pre>curl -sSL https://get.docker.com/ <span class="pl-k">|</span> sh</pre></div>

<ul>
<li>install docker compose (<a href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a>)</li>
</ul>

<div class="highlight highlight-source-shell"><pre>curl -L https://github.com/docker/compose/releases/download/1.6.0/docker-compose-<span class="pl-s"><span class="pl-pds">`</span>uname -s<span class="pl-pds">`</span></span>-<span class="pl-s"><span class="pl-pds">`</span>uname -m<span class="pl-pds">`</span></span> <span class="pl-k">&gt;</span> /usr/local/bin/docker-compose</pre></div>

<h2>
<a id="下載考題解答環境" class="anchor" href="#%E4%B8%8B%E8%BC%89%E8%80%83%E9%A1%8C%E8%A7%A3%E7%AD%94%E7%92%B0%E5%A2%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>下載考題/解答環境</h2>

<p>請下載到家目錄</p>

<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">cd</span> <span class="pl-k">~</span>
$ git@github.com:Easter1021/homestead-docker.git
$ <span class="pl-c1">cd</span> homestead-docker
$ docker build -t shincoder/homestead <span class="pl-c1">.</span>

<span class="pl-c"># 將會花費少許時間安裝</span></pre></div>

<h2>
<a id="建立環境" class="anchor" href="#%E5%BB%BA%E7%AB%8B%E7%92%B0%E5%A2%83" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>建立環境</h2>

<p>以下指令將會安裝2個容器：web container 和 mysql container，並且在 mysql container 建立 trubuzz 資料庫和具有存取權限的使用者( id: trubuzz / pw: challenge)。</p>

<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">cd</span> <span class="pl-k">~</span>/homestead-docker
$ docker-machine start default
$ docker-machine env
<span class="pl-k">export</span> DOCKER_TLS_VERIFY=<span class="pl-s"><span class="pl-pds">"</span>1<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> DOCKER_HOST=<span class="pl-s"><span class="pl-pds">"</span>tcp://192.168.99.100:2376<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> DOCKER_CERT_PATH=<span class="pl-s"><span class="pl-pds">"</span>/Users/gexu/.docker/machine/machines/default<span class="pl-pds">"</span></span>
<span class="pl-k">export</span> DOCKER_MACHINE_NAME=<span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>
<span class="pl-c"># Run this command to configure your shell: </span>
<span class="pl-c"># eval $(docker-machine env)</span></pre></div>

<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">eval</span> <span class="pl-s"><span class="pl-pds">$(</span>docker-machine env<span class="pl-pds">)</span></span>
$ docker-compose up -d
Creating homesteaddocker_mysql_1
Creating homesteaddocker_web_1</pre></div>

<p>現在你可以使用下列指令進入 web container </p>

<div class="highlight highlight-source-shell"><pre>$ ssh -p 2222 homestead@192.168.99.100
The authenticity of host <span class="pl-s"><span class="pl-pds">'</span>[192.168.99.100]:2222 ([192.168.99.100]:2222)<span class="pl-pds">'</span></span> can<span class="pl-s"><span class="pl-pds">'</span>t be established.</span>
<span class="pl-s">ECDSA key fingerprint is SHA256:VzI0s5Bt1m0FT0DsuCdLczCC3GhfR5LRtzOyXIY/0HQ.</span>
<span class="pl-s">Are you sure you want to continue connecting (yes/no)? yes</span>
<span class="pl-s">homestead@b45492bf2d7f:~$</span>
<span class="pl-s"></span>
<span class="pl-s"># 其中 192.168.99.100 是 docker-machine env 的 DOCKER_HOST</span>
<span class="pl-s"># b45492bf2d7f 則是 web container 的代號</span></pre></div>

<h2>
<a id="初始化環境下載後第1次設定即可" class="anchor" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%92%B0%E5%A2%83%E4%B8%8B%E8%BC%89%E5%BE%8C%E7%AC%AC1%E6%AC%A1%E8%A8%AD%E5%AE%9A%E5%8D%B3%E5%8F%AF" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>初始化環境(下載後第1次設定即可)</h2>

<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">cd</span> <span class="pl-k">~</span>/homestead-docker/apps/trubuzz_challenge
$ php -r <span class="pl-s"><span class="pl-pds">"</span>copy('.env.example', '.env');<span class="pl-pds">"</span></span>
$ Illuminate<span class="pl-cce">\F</span>oundation<span class="pl-cce">\C</span>omposerScripts::postInstall
$ php artisan optimize
$ php artisan key:generate
$ composer install</pre></div>

<p>資料填充 <a href="https://laravel.tw/docs/5.1/seeding#writing-seeders">https://laravel.tw/docs/5.1/seeding#writing-seeders</a></p>

<div class="highlight highlight-source-shell"><pre>$ <span class="pl-c1">cd</span> <span class="pl-k">~</span>/homestead-docker/apps/trubuzz_challenge
$ php artisan migrate:refresh --seed</pre></div>

<h2>
<a id="設定-virtual-host" class="anchor" href="#%E8%A8%AD%E5%AE%9A-virtual-host" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>設定 virtual host</h2>

<p>在本機端編輯 /etc/hosts 加入 virtual host (以下為 Mac OS 環境)</p>

<div class="highlight highlight-source-shell"><pre>$ sudo vi /etc/hosts
<span class="pl-c">##</span>
<span class="pl-c"># Host Database</span>
<span class="pl-c">#</span>
<span class="pl-c"># localhost is used to configure the loopback interface</span>
<span class="pl-c"># when the system is booting.  Do not change this entry.</span>
<span class="pl-c">##</span>
127.0.0.1       localhost
255.255.255.255 broadcasthost
::1             localhost
fe80::1%lo0     localhost

192.168.99.100  trubuzz.challenge.<span class="pl-c1">test</span>  <span class="pl-c"># &lt;--加入這行</span></pre></div>

<h2>
<a id="這樣應該就可以測試了" class="anchor" href="#%E9%80%99%E6%A8%A3%E6%87%89%E8%A9%B2%E5%B0%B1%E5%8F%AF%E4%BB%A5%E6%B8%AC%E8%A9%A6%E4%BA%86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>這樣應該就可以測試了</h2>

<p>現在，請在網址打入 <a href="http://trubuzz.challenge.test:8000/">http://trubuzz.challenge.test:8000/</a> 開始測試。</p>

<h2>
<a id="api-document" class="anchor" href="#api-document" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API Document</h2>

<p>網站需要一些API，因此在路由前綴加上 <code>/api</code> 即回傳的格式為json；</p>

<p>像是 <code>/api/users</code> 和 <code>/users</code>，前者取得 json，後者取得 html</p>

<p>另外，關於 1-5 如果在API有數十甚至上百的情況下，</p>

<p>在沒有 cache 的情況下，將使用 <code>分頁</code> 進行效能管理。</p>

<h3>
<a id="建立user" class="anchor" href="#%E5%BB%BA%E7%AB%8Buser" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>建立User</h3>

<div class="highlight highlight-source-shell"><pre>// 回傳 json 格式
curl -X POST http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/users
     -F <span class="pl-s"><span class="pl-pds">"</span>username=Charles<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>email=mufasa.hsu@gmail.com<span class="pl-pds">"</span></span>

// 回傳 json 格式 (format: 1, <span class="pl-c1">true</span>, True)
curl -X POST http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/users
     -F <span class="pl-s"><span class="pl-pds">"</span>format=True<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>username=Charles<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>email=mufasa.hsu@gmail.com<span class="pl-pds">"</span></span>

// 回傳 html 格式
curl -X POST http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/users
     -H <span class="pl-s"><span class="pl-pds">"</span>Content-Type: application/x-www-form-urlencoded<span class="pl-pds">"</span></span>
     -H <span class="pl-s"><span class="pl-pds">"</span>Accept: text/html<span class="pl-pds">"</span></span> 
     -F <span class="pl-s"><span class="pl-pds">"</span>username=Charles<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>email=mufasa.hsu@gmail.com<span class="pl-pds">"</span></span></pre></div>

<p>回傳JSON內容</p>

<pre lang="#!json"><code>{
  "username": "Charles"
  "email": "mufasa.hsu@gmail.com"
  "created_time": {
    "date": "2016-03-26 13:23:38.000000"
    "timezone_type": 3
    "timezone": "UTC"
  }
  "id": 1
}
</code></pre>

<h3>
<a id="查詢所有user" class="anchor" href="#%E6%9F%A5%E8%A9%A2%E6%89%80%E6%9C%89user" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>查詢所有User</h3>

<div class="highlight highlight-source-shell"><pre>curl http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/users</pre></div>

<p>回傳JSON內容</p>

<pre lang="#!json"><code>{
  "total": 11
  "per_page": 15
  "current_page": 1
  "last_page": 1
  "next_page_url": null
  "prev_page_url": null
  "from": 1
  "to": 11
  "data": [11]
    0:  {
      "id": 1
      "username": "Charles"
      ....
</code></pre>

<p>(回傳內容以下將不會解釋說明!)</p>

<p>(回傳內容以下將不會解釋說明!!)</p>

<p>(回傳內容以下將不會解釋說明!!!)</p>

<h3>
<a id="查詢個別user" class="anchor" href="#%E6%9F%A5%E8%A9%A2%E5%80%8B%E5%88%A5user" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>查詢個別User</h3>

<div class="highlight highlight-source-shell"><pre>curl http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/users/1</pre></div>

<h3>
<a id="查詢個別user所擁有的book" class="anchor" href="#%E6%9F%A5%E8%A9%A2%E5%80%8B%E5%88%A5user%E6%89%80%E6%93%81%E6%9C%89%E7%9A%84book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>查詢個別User所擁有的Book</h3>

<div class="highlight highlight-source-shell"><pre>curl http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/users/1/books</pre></div>

<h3>
<a id="為user添加book" class="anchor" href="#%E7%82%BAuser%E6%B7%BB%E5%8A%A0book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>為User添加Book</h3>

<div class="highlight highlight-source-shell"><pre>curl -X POST http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books
     -F <span class="pl-s"><span class="pl-pds">"</span>user_id=1<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>title=Marvel<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>description=Marvel Worldwide Inc., commonly referred to as Marvel Comics and formerly Marvel Publishing, Inc. and Marvel Comics Group, is an American publisher of comic books and related media.<span class="pl-pds">"</span></span></pre></div>

<h3>
<a id="為user移除book" class="anchor" href="#%E7%82%BAuser%E7%A7%BB%E9%99%A4book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>為User移除Book</h3>

<div class="highlight highlight-source-shell"><pre>curl –X DELETE http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/users/1/books/1</pre></div>

<h3>
<a id="建立book-不要加-user_id-" class="anchor" href="#%E5%BB%BA%E7%AB%8Bbook-%E4%B8%8D%E8%A6%81%E5%8A%A0-user_id-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>建立Book (不要加 user_id )</h3>

<div class="highlight highlight-source-shell"><pre>curl -X POST http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books
     -F <span class="pl-s"><span class="pl-pds">"</span>title=Marvel<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>description=Marvel Worldwide Inc., commonly referred to as Marvel Comics and formerly Marvel Publishing, Inc. and Marvel Comics Group, is an American publisher of comic books and related media.<span class="pl-pds">"</span></span></pre></div>

<h3>
<a id="刪除book" class="anchor" href="#%E5%88%AA%E9%99%A4book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>刪除Book</h3>

<div class="highlight highlight-source-shell"><pre>curl –X DELETE http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books/1</pre></div>

<h3>
<a id="修改book" class="anchor" href="#%E4%BF%AE%E6%94%B9book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>修改Book</h3>

<div class="highlight highlight-source-shell"><pre>curl -X PUT http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books/1
     -F <span class="pl-s"><span class="pl-pds">"</span>title=DC Comics<span class="pl-pds">"</span></span>
     -F <span class="pl-s"><span class="pl-pds">"</span>description=DC Comics, Inc. is an American comic book publisher. It is the publishing unit of DC Entertainment,[2] a company of Warner Bros. Entertainment, which itself is owned by Time Warner.<span class="pl-pds">"</span></span></pre></div>

<h3>
<a id="查詢所有book" class="anchor" href="#%E6%9F%A5%E8%A9%A2%E6%89%80%E6%9C%89book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>查詢所有Book</h3>

<div class="highlight highlight-source-shell"><pre>curl http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books</pre></div>

<h3>
<a id="查詢個別book" class="anchor" href="#%E6%9F%A5%E8%A9%A2%E5%80%8B%E5%88%A5book" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>查詢個別Book</h3>

<div class="highlight highlight-source-shell"><pre>curl http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books/1</pre></div>

<h3>
<a id="查詢個別book被誰所擁有" class="anchor" href="#%E6%9F%A5%E8%A9%A2%E5%80%8B%E5%88%A5book%E8%A2%AB%E8%AA%B0%E6%89%80%E6%93%81%E6%9C%89" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>查詢個別Book被誰所擁有</h3>

<div class="highlight highlight-source-shell"><pre>curl http://trubuzz.challenge.<span class="pl-c1">test</span>:8000/api/books/1/user</pre></div>

<h2>
<a id="網頁介面-關於新書通知" class="anchor" href="#%E7%B6%B2%E9%A0%81%E4%BB%8B%E9%9D%A2-%E9%97%9C%E6%96%BC%E6%96%B0%E6%9B%B8%E9%80%9A%E7%9F%A5" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>網頁介面 (關於新書通知)</h2>

<p>關於通知有許多作法，此系統使用的是 "cmgmyr/messenger": "~2.0"</p>

<p>每位用戶都可以在這個頁面模擬登入，登入後可以關注其它用戶。</p>

<p>有2個情況，系統會發通知訊息給用戶：</p>

<ol>
<li>是用戶被關注時</li>
<li>是關注的人發表新書時，追隨者會收到通知</li>
</ol>

<p>登入此頁以操作功能 <a href="http://trubuzz.challenge.test:8000/users">http://trubuzz.challenge.test:8000/users</a></p>

<p><img src="https://raw.githubusercontent.com/Easter1021/homestead-docker/master/images/users.png" alt="用戶列表"></p>

<p>點擊右上角「訊息」即可查看消息列表</p>

<p><img src="https://raw.githubusercontent.com/Easter1021/homestead-docker/master/images/attention.png" alt="訊息列表"></p>

<h2>
<a id="結語" class="anchor" href="#%E7%B5%90%E8%AA%9E" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>結語</h2>

<p>此系統執行 TruBuzz Challenge 大多數的任務項目，在本次挑戰中針對考題1~5並沒有太多的問題，像是 Laravel 的路由、中介層、回應、Eloquent ORM、cmgmyr/messenger。關於 API 的技巧上，我使用 <code>Route Prefixes</code> 來判斷系統需回傳的內容。</p>

<p>對於較不熟 <code>Docker</code> 也花費許多時間去學習了解並且找到較適合 Laravel homestead 的 docker 環境，我想這是本測驗中學習最多的部份。有關 Ansible 交付 Docker 在此系統中並沒有完成，但我找到 IBM 發佈的 <a href="https://www.evernote.com/shard/s32/nl/3685155/2212cd74-adc5-4198-949f-2eac334a8ceb/?csrfBusterToken=U%3D383b23%3AP%3D%2F%3AE%3D153b606a5e1%3AS%3D1bf67f81e19d79faaa16713cc7804520">Best Practice</a>，目前正努力學習了解中。希望未來有機會可以學習公司的用法。</p>

<p>本次依照 git flow 的標準來管理版本，請參照下圖：</p>

<p><img src="https://raw.githubusercontent.com/Easter1021/homestead-docker/master/images/git-model@2x.png" alt="git flow best practice"></p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/Easter1021">Easter1021</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>
